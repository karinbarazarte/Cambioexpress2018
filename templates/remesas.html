{% extends "dashboard.html" %}
{% block content %}
<h1 style="margin-bottom:20px;">Registrar Remesa</h1>
<form>
    <div>
        <label>Nro de operación</label>
        <input type="text" name="operacion">
    </div>
    <div>
        <label>Fecha</label>
        <input type="date" name="fecha">
    </div>
    <div>
        <label>País de origen</label>
        <select id="pais_origen" onchange="calcularMonto()">
            <option value="">Seleccione</option>
            {% for pais in paises %}<option>{{ pais }}</option>{% endfor %}
        </select>
    </div>
    <div>
        <label>País destino</label>
        <select id="pais_destino" onchange="calcularMonto()">
            <option value="">Seleccione</option>
            {% for pais in paises %}<option>{{ pais }}</option>{% endfor %}
        </select>
    </div>
    <div>
        <label>Banco</label>
        <select>
            {% for banco in bancos %}<option>{{ banco }}</option>{% endfor %}
        </select>
    </div>
    <div>
        <label>Tasa</label>
        <input type="number" id="tasa" step="0.01" oninput="calcularMonto()">
    </div>
    <div>
        <label>Monto recibido</label>
        <input type="number" id="monto" oninput="calcularMonto()">
    </div>
    <div>
        <label>Monto a recibir</label>
        <input type="number" id="monto_recibir" readonly>
    </div>
    <div>
        <label>Tipo de transacción</label>
        <select>
            <option>Seleccione</option>
            <option>Transferencia</option>
            <option>Yape</option>
        </select>
    </div>
    <div>
        <label>¿Viene de colaborador?</label>
        <select id="colaborador_toggle" onchange="toggleColaborador()">
            <option value="No">No</option>
            <option value="Si">Sí</option>
        </select>
    </div>
    <div id="colaborador_section" class="hidden">
        <label>Seleccionar colaborador</label>
        <select>
            {% for c in colaboradores %}<option>{{ c }}</option>{% endfor %}
        </select>
    </div>
    <div>
        <label>Cliente</label>
        <input type="text">
    </div>
    <p id="warning" class="warning">No hay regla definida, edite manualmente el monto a recibir.</p>
    <button type="submit" class="submit-btn">Registrar</button>
</form>

<script>
function calcularMonto(){
    const origen=document.getElementById("pais_origen").value;
    const destino=document.getElementById("pais_destino").value;
    const monto=parseFloat(document.getElementById("monto").value);
    const tasa=parseFloat(document.getElementById("tasa").value);
    const mult=[["Perú","Venezuela"],["Chile","Venezuela"],["Perú","Colombia"],["Perú","Chile"],["Chile","Colombia"]];
    const div=[["Venezuela","Perú"],["Venezuela","Chile"],["Chile","Perú"],["Colombia","Chile"],["Colombia","Perú"],["Colombia","Venezuela"]];
    const resInput=document.getElementById("monto_recibir");
    const warning=document.getElementById("warning");
    if(!isNaN(monto)&&!isNaN(tasa)){
        if(mult.some(p=>p[0]===origen&&p[1]===destino)){
            resInput.value=(monto*tasa).toFixed(2);
            resInput.readOnly=true;
            warning.style.display="none";
        } else if(div.some(p=>p[0]===origen&&p[1]===destino)){
            resInput.value=(monto/tasa).toFixed(2);
            resInput.readOnly=true;
            warning.style.display="none";
        } else {
            resInput.readOnly=false;
            warning.style.display="block";
        }
    }
}
function toggleColaborador(){
    const val=document.getElementById("colaborador_toggle").value;
    const section=document.getElementById("colaborador_section");
    section.className=(val==="Si")?"":"hidden";
}
</script>
{% endblock %}
